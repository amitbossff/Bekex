<!DOCTYPE html>
<html>
<head>
    <title>Play Store Reviews - Infinite Scroll</title>
    <style>
        body { font-family: Arial; }
        .date-block { margin-bottom: 30px; }
    </style>
</head>
<body>

<h2>Play Store Reviews (Auto Load on Scroll)</h2>

<input type="text" id="link" placeholder="Play Store App Link" style="width:300px;">
<button onclick="start()">Start</button>

<div id="reviews"></div>

<p id="loading" style="display:none;">Loading...</p>

<script>
let cursor = null;
let appLink = "";
let loading = false;
let finished = false;

function start() {
    document.getElementById("reviews").innerHTML = "";
    cursor = null;
    finished = false;
    appLink = document.getElementById("link").value;
    loadMore();
}

function loadMore() {
    if (loading || finished) return;

    loading = true;
    document.getElementById("loading").style.display = "block";

    fetch("/fetch", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ link: appLink, cursor: cursor })
    })
    .then(res => res.json())
    .then(res => {
        document.getElementById("loading").style.display = "none";
        loading = false;

        if (res.error) {
            alert(res.error);
            return;
        }

        cursor = res.cursor;
        if (!cursor) finished = true;

        for (let date in res.data) {
            let block = document.createElement("div");
            block.className = "date-block";
            block.innerHTML = `<h3>${date} (${res.data[date].length})</h3>`;

            let ul = document.createElement("ul");
            res.data[date].forEach(name => {
                let li = document.createElement("li");
                li.innerText = name;
                ul.appendChild(li);
            });

            block.appendChild(ul);
            document.getElementById("reviews").appendChild(block);
        }
    });
}

// ðŸ”¥ AUTO LOAD WHEN SCROLL BOTTOM
window.addEventListener("scroll", () => {
    if (
        window.innerHeight + window.scrollY >=
        document.body.offsetHeight - 200
    ) {
        loadMore();
    }
});
</script>

</body>
  </html>
